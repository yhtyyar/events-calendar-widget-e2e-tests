#!/bin/bash

# Git hook для проверки формата сообщений коммитов
# Требования:
# - Сообщение должно начинаться с русской буквы
# - Запрещены conventional commits префиксы (feat:, fix:, etc.)
# - Запрещены emoji

MSG=$(cat "$1")

# Проверка на русский язык (должно начинаться с кириллицы)
if ! echo "$MSG" | grep -qP '^[А-ЯЁа-яё]'; then
  echo ""
  echo "ОШИБКА: Сообщение коммита должно начинаться с русской буквы"
  echo ""
  echo "Примеры корректных сообщений:"
  echo "  - Добавил тесты авторизации через OAuth2"
  echo "  - Исправил селекторы кнопки оплаты"
  echo "  - Настроил параллельный запуск в CI"
  echo "  - Рефакторинг модуля токенов"
  echo ""
  exit 1
fi

# Проверка на conventional commits префиксы
if echo "$MSG" | grep -qiE '^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?:'; then
  echo ""
  echo "ОШИБКА: Не используйте conventional commits префиксы (feat:, fix:, etc.)"
  echo "Начните сообщение с глагола в прошедшем времени на русском языке"
  echo ""
  exit 1
fi

# Проверка на emoji
if echo "$MSG" | grep -qP '[\x{1F300}-\x{1F9FF}]|[\x{2600}-\x{26FF}]|[\x{2700}-\x{27BF}]'; then
  echo ""
  echo "ОШИБКА: Emoji в сообщениях коммитов запрещены"
  echo ""
  exit 1
fi

# Проверка на восклицательные знаки в начале
if echo "$MSG" | grep -qE '^[^.]+!'; then
  echo ""
  echo "ПРЕДУПРЕЖДЕНИЕ: Избегайте восклицательных знаков в сообщениях коммитов"
  echo ""
fi

exit 0
